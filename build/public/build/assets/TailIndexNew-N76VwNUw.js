import{r as h,j as e,t as S,S as j,Q as K}from"./app-DQ50vfdB.js";import{W as M}from"./WorkflowStepIndicator-DUsDAVIY.js";import{P as z,S as D,a as H,T as L}from"./trash-2-CeSk2DMr.js";import{c as P}from"./createLucideIcon-BDCxl-nA.js";import{E as q}from"./eye-BNEHF507.js";import{C as V}from"./clock-D7XOpUOi.js";import{L as J}from"./lock-DA_Cv4-T.js";import{T as O}from"./TailLayout-CUFZkN9l.js";import"./TechStackBackground-vFG2YikW.js";import"./index-CXCxKWl8.js";import"./XMarkIcon-iLJawDXb.js";import"./UsersIcon-Do4GODTd.js";import"./transition-B40-nL65.js";import"./dialog-B4S7MQxj.js";import"./with-selector-CC73ae-U.js";import"./index-OSMIWnHG.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],G=P("lock-open",Q);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],I=P("user-check",X),Y=({status:m})=>{const u=s=>({diajukan:"bg-blue-100 text-blue-800",diperiksa:"bg-yellow-100 text-yellow-800",dikembalikan:"bg-red-100 text-red-800",dianalisis:"bg-purple-100 text-purple-800",siap_diputuskan:"bg-indigo-100 text-indigo-800",disetujui:"bg-green-100 text-green-800",ditolak:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",g=s=>({diajukan:"Diajukan",diperiksa:"Diperiksa",dikembalikan:"Dikembalikan",dianalisis:"Dianalisis",siap_diputuskan:"Siap Diputuskan",disetujui:"Disetujui",ditolak:"Ditolak"})[s]||s.toUpperCase();return e.jsx("span",{className:`inline-flex rounded-full px-2 py-1 text-xs font-semibold ${u(m)}`,children:g(m)})},Z=({data:m,canCreate:u=!1,onDelete:g,currentUserRole:s})=>{const[l,p]=h.useState(""),[d,c]=h.useState(""),[n,k]=h.useState("created_at"),[o,y]=h.useState("desc"),N=[{value:"",label:"Semua Status"},{value:"diajukan",label:"Diajukan"},{value:"diperiksa",label:"Diperiksa"},{value:"dikembalikan",label:"Dikembalikan"},{value:"dianalisis",label:"Dianalisis"},{value:"siap_diputuskan",label:"Siap Diputuskan"},{value:"disetujui",label:"Disetujui"},{value:"ditolak",label:"Ditolak"}],w=a=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(a),E=a=>new Date(a).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"}),v=m.filter(a=>{var i,x,b,C,T,A;const r=((x=(i=a.nasabah)==null?void 0:i.nama_lengkap)==null?void 0:x.toLowerCase().includes(l.toLowerCase()))||((C=(b=a.nasabah)==null?void 0:b.nik)==null?void 0:C.includes(l))||((A=(T=a.nasabah)==null?void 0:T.nomor_ktp)==null?void 0:A.includes(l))||a.id.toString().includes(l),t=d===""||a.status===d;return r&&t}).sort((a,r)=>{var x,b;let t=a[n],i=r[n];return n==="nasabah"&&(t=((x=a.nasabah)==null?void 0:x.nama_lengkap)||"",i=((b=r.nasabah)==null?void 0:b.nama_lengkap)||""),typeof t=="string"&&typeof i=="string"?o==="asc"?t.localeCompare(i):i.localeCompare(t):typeof t=="number"&&typeof i=="number"?o==="asc"?t-i:i-t:0}),f=a=>{n===a?y(o==="asc"?"desc":"asc"):(k(a),y("asc"))},B=()=>{j.get("/pinjaman",{search:l,status:d},{preserveState:!0,preserveScroll:!0})},$=()=>{p(""),c(""),j.get("/pinjaman",{},{preserveState:!0,preserveScroll:!0})},W=a=>{j.post(`/workflow/take/${a}`,{catatan:"Berkas diambil untuk diproses"},{preserveState:!1,preserveScroll:!0,onSuccess:r=>{window.location.reload()},onError:r=>{console.error("Error taking pinjaman:",r),alert("Gagal mengambil berkas: "+(r.message||"Terjadi kesalahan"))}})},_=a=>{if(!s)return null;switch(a.status){case"diajukan":if(s==="admin_kredit")return a.admin_kredit?"locked":"available";break;case"diperiksa":if(s==="admin_kredit"&&a.admin_kredit)return"working";break;case"dianalisis":if(s==="analis")return a.analis?"locked":"available";break;case"siap_diputuskan":if(s==="pemutus")return a.pemutus?"locked":"available";break;case"dikembalikan":if(s==="staf_input")return"need_action";break}return null},F=a=>{switch(_(a)){case"available":return e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"mr-2 h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:"Tersedia Diambil"})]});case"locked":const t=a.admin_kredit||a.analis||a.pemutus;return e.jsxs("div",{className:"flex items-center",children:[e.jsx(J,{className:"mr-2 h-4 w-4 text-red-500"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm font-medium text-red-600",children:"Dikerjakan"}),t&&e.jsxs("span",{className:"text-xs text-gray-500",children:["oleh ",t.name]})]})]});case"working":return e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"mr-2 h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:"Sedang Dikerjakan"})]});case"need_action":return e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"mr-2 h-4 w-4 text-orange-500"}),e.jsx("span",{className:"text-sm font-medium text-orange-600",children:"Perlu Tindakan"})]});default:return e.jsx("span",{className:"text-sm text-gray-500",children:"-"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Daftar Pinjaman"}),e.jsx("p",{className:"text-gray-600",children:"Kelola semua pengajuan pinjaman nasabah"})]}),u&&e.jsxs(S,{href:"/pinjaman/create/wizard-new",className:"inline-flex items-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),"Buat Pengajuan Baru"]})]}),e.jsx("div",{className:"rounded-lg bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3",children:e.jsx(D,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Cari nasabah, NIK, atau ID...",value:l,onChange:a=>p(a.target.value),className:"block w-full rounded-lg border border-gray-300 py-2 pl-10 pr-3 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("select",{value:d,onChange:a=>c(a.target.value),className:"rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:ring-1 focus:ring-blue-500",children:N.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsxs("button",{onClick:B,className:"inline-flex items-center rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700",children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Cari"]}),e.jsx("button",{onClick:$,className:"inline-flex items-center rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Reset"})]})]})}),e.jsx("div",{className:"overflow-hidden rounded-lg bg-white shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"cursor-pointer px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 hover:bg-gray-100",onClick:()=>f("id"),children:["ID"," ",n==="id"&&(o==="asc"?"↑":"↓")]}),e.jsxs("th",{className:"cursor-pointer px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 hover:bg-gray-100",onClick:()=>f("nasabah"),children:["Nasabah"," ",n==="nasabah"&&(o==="asc"?"↑":"↓")]}),e.jsxs("th",{className:"cursor-pointer px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 hover:bg-gray-100",onClick:()=>f("jumlah_pinjaman"),children:["Jumlah"," ",n==="jumlah_pinjaman"&&(o==="asc"?"↑":"↓")]}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Tujuan"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Progress"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Ketersediaan"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Jangka Waktu"}),e.jsxs("th",{className:"cursor-pointer px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 hover:bg-gray-100",onClick:()=>f("status"),children:["Status"," ",n==="status"&&(o==="asc"?"↑":"↓")]}),e.jsxs("th",{className:"cursor-pointer px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500 hover:bg-gray-100",onClick:()=>f("created_at"),children:["Tanggal"," ",n==="created_at"&&(o==="asc"?"↑":"↓")]}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Aksi"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:v.length>0?v.map(a=>{var r,t,i,x;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900",children:["#",a.id]}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((r=a.nasabah)==null?void 0:r.nama_lengkap)||"N/A"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["NIK:"," ",((t=a.nasabah)==null?void 0:t.nik)||((i=a.nasabah)==null?void 0:i.nomor_ktp)||"N/A"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["WA: ",((x=a.nasabah)==null?void 0:x.nomor_wa)||"N/A"]})]}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm font-medium text-gray-900",children:w(a.jumlah_pinjaman)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:e.jsx("div",{className:"max-w-xs truncate",children:a.tujuan_pinjaman||"N/A"})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx(M,{currentStatus:a.status})}),e.jsx("td",{className:"px-6 py-4",children:F(a)}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-900",children:a.jangka_waktu?`${a.jangka_waktu} bulan`:"N/A"}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4",children:e.jsx(Y,{status:a.status})}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500",children:E(a.created_at)}),e.jsx("td",{className:"whitespace-nowrap px-6 py-4 text-sm font-medium",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[_(a)==="available"&&e.jsxs("button",{onClick:()=>W(a.id),className:"inline-flex items-center rounded-md border border-green-300 bg-green-50 px-3 py-1 text-xs font-medium text-green-700 transition-colors hover:bg-green-100 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2",title:"Ambil Berkas",children:[e.jsx(I,{className:"mr-1 h-3 w-3"}),"Ambil"]}),e.jsx(S,{href:`/pinjaman/${a.id}`,className:"rounded p-1 text-blue-600 transition-colors hover:bg-blue-50 hover:text-blue-900",title:"Lihat Detail",children:e.jsx(q,{className:"h-4 w-4"})}),(s==="staf_input"||s==="admin")&&e.jsx(S,{href:`/pinjaman/${a.id}/edit`,className:"rounded p-1 text-green-600 transition-colors hover:bg-green-50 hover:text-green-900",title:"Edit",children:e.jsx(H,{className:"h-4 w-4"})}),a.status==="diajukan"&&(s==="staf_input"||s==="admin")&&g&&e.jsx("button",{onClick:()=>g(a.id),className:"rounded p-1 text-red-600 transition-colors hover:bg-red-50 hover:text-red-900",title:"Hapus",children:e.jsx(L,{className:"h-4 w-4"})})]})})]},a.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"px-6 py-12 text-center text-sm text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(D,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Tidak ada data"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Tidak ada pinjaman yang sesuai dengan filter yang dipilih."})]})})})})]})})}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Menampilkan ",v.length," dari ",m.length," pinjaman"]})]})},pe=({auth:m,pinjaman:u,filters:g,metadata:s,currentUserRole:l})=>{const[p,d]=h.useState({open:!1,id:null}),[c,n]=h.useState({open:!1,id:null,action:"",title:"",message:""}),k=w=>{d({open:!0,id:w})},o=()=>{p.id&&j.delete(`/pinjaman/${p.id}`,{onSuccess:()=>{d({open:!1,id:null})},onError:()=>{d({open:!1,id:null})}})},y=()=>{c.id&&c.action&&j.post(`/pinjaman/${c.id}/workflow-action`,{action:c.action},{onSuccess:()=>{n({open:!1,id:null,action:"",title:"",message:""})},onError:()=>{n({open:!1,id:null,action:"",title:"",message:""})}})},N=m.user.role==="staf_input"||m.user.role==="admin";return e.jsxs(O,{children:[e.jsx(K,{title:"Daftar Pinjaman"}),e.jsx("div",{className:"p-6",children:e.jsx(Z,{data:(u==null?void 0:u.data)||[],canCreate:N,onDelete:k,currentUserRole:l})}),p.open&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"}),e.jsxs("div",{className:"inline-block transform overflow-hidden rounded-lg bg-white text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:align-middle",children:[e.jsx("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx(L,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Konfirmasi Hapus"}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Apakah Anda yakin ingin menghapus pinjaman ini? Tindakan ini tidak dapat dibatalkan."})})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[e.jsx("button",{type:"button",onClick:o,className:"inline-flex w-full justify-center rounded-md border border-transparent bg-red-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm",children:"Hapus"}),e.jsx("button",{type:"button",onClick:()=>d({open:!1,id:null}),className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:ml-3 sm:mt-0 sm:w-auto sm:text-sm",children:"Batal"})]})]})]})}),c.open&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"}),e.jsxs("div",{className:"inline-block transform overflow-hidden rounded-lg bg-white text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:align-middle",children:[e.jsx("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:e.jsxs("div",{className:"sm:flex sm:items-start",children:[e.jsx("div",{className:"mx-auto flex h-12 w-12 flex-shrink-0 items-center justify-center rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10",children:e.jsx("svg",{className:"h-6 w-6 text-blue-600",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"mt-3 text-center sm:ml-4 sm:mt-0 sm:text-left",children:[e.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:c.title}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:c.message})})]})]})}),e.jsxs("div",{className:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6",children:[e.jsx("button",{type:"button",onClick:y,className:"inline-flex w-full justify-center rounded-md border border-transparent bg-blue-600 px-4 py-2 text-base font-medium text-white shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:ml-3 sm:w-auto sm:text-sm",children:"Konfirmasi"}),e.jsx("button",{type:"button",onClick:()=>n({open:!1,id:null,action:"",title:"",message:""}),className:"mt-3 inline-flex w-full justify-center rounded-md border border-gray-300 bg-white px-4 py-2 text-base font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 sm:ml-3 sm:mt-0 sm:w-auto sm:text-sm",children:"Batal"})]})]})]})})]})};export{pe as default};
